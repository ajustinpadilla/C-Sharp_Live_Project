@using TheatreCMS.Controllers
@model IEnumerable<TheatreCMS.Models.CastMember>


@{
    ViewBag.Title = "Cast";
    // UserIds set to make it easier to read
    var UserIds = ViewBag.Users as Dictionary<string, string>;
}

<h1 class="text-center">Cast</h1>

<p>
    @*Create is admin only*@
    @if (User.IsInRole("Admin"))
    {
        @Html.ActionLink("Create New", "Create")
    }
</p>


<div class="row castMargin">
    @foreach (var item in Model)
    {
        <div class="col-md-4 castContainer">
            <div class="thumbnail">
                <div class="castImageContainer">
                    @*<img class="castImage" src="@Url.Content("~/Content/Images/CastMember.jpg")" style="width:100%">*@
                    @{
                        string img = "";
                        if (item.Photo != null)
                        {
                            byte[] thumbBytes = ImageUploadController.ImageThumbnail(item.Photo, 100, 100);
                            var base64 = System.Convert.ToBase64String(thumbBytes);
                            img = String.Format("data:image/png;base64,{0}", base64);
                        }
                        else
                        {
                            img = @Url.Content("~/Content/Images/CastMember.jpg");
                        }
                    }
                    <a href="@Url.Action("Details", "CastMembers", new { id = item.CastMemberID })"> <img class="castImage" src="@img" style="width:100%" /> </a>
                    <div class="castMiddle">
                        <a href="@Url.Action("Details", "CastMembers", new { id = item.CastMemberID })">
                            @{ if (item.Bio.Length > 90)                           // the max allowable characters can be changed on this line, and 
                                {
                                    item.Bio = item.Bio.Substring(0, 90) + "..."; //                                                      this line
                                }
                            }
                            <p class="castText">@Html.DisplayFor(modelItem => item.Bio)</p>
                        </a>
                    </div>
                </div>
                <div class="caption text-center">
                    <p>
                        @Html.DisplayFor(modelItem => item.Name) |
                        Joined our cast: @Html.DisplayFor(modelItem => item.YearJoined) |
                        Role: @Html.DisplayFor(modelItem => item.MainRole)
                    </p>
                    <p>
                        @*Delete and edit are admin only*@

                        @if (User.IsInRole("Admin"))
                        {
                            @Html.ActionLink("Edit", "Edit", new { id = item.CastMemberID })
                            @(" |")
                        }

                        @*@Html.ActionLink("Details", "Details", new { id = item.CastMemberID })*@

                        @if (User.IsInRole("Admin"))
                        {
                            @Html.ActionLink("Delete", "Delete", new { id = item.CastMemberID })
                        }
                    </p>
                </div>
            </div>
        </div>
    }
</div>