@using TheatreCMS.Controllers
@model IEnumerable<TheatreCMS.Models.CastMember>


@{
  ViewBag.Title = "Cast";
  // UserIds set to make it easier to read
  var UserIds = ViewBag.Users as Dictionary<string, string>;
}

<h1 class="text-center">Cast</h1>

<p>
  @*Create is admin only*@
  @if (User.IsInRole("Admin"))
  {
    @Html.ActionLink("Create New", "Create")
  }
</p>

@*<div class="container" id="castContainer">
  <div class="row">*@
@*<div class="castContainer">*@

<div class="card-columns">
  @*<div class="castContainer m-5 pl-3 pt-0 pb-1">*@
  @foreach (var item in Model)
  {
    <div class="castImageContainer">
      @{
        string img = "";
        if (item.Photo != null)
        {
          byte[] thumbBytes = ImageUploadController.ImageThumbnail(item.Photo, 100, 100);
          var base64 = System.Convert.ToBase64String(thumbBytes);
          img = String.Format("data:image/png;base64,{0}", base64);
        }
        else
        {
          img = @Url.Content("~/Content/Images/CastMember.jpg");
        }
      }
      <a href="@Url.Action("Details", "CastMembers", new { id = item.CastMemberID })"> <img class="card-img-top" id="castImage" src="@img" /> </a>
      <div class="castMiddle">
        <a href="@Url.Action("Details", "CastMembers", new { id = item.CastMemberID })">
          @{ if (item.Bio != null && item.Bio.Length > 90)                     // the max allowable characters can be changed on this line, and
            {
              item.Bio = item.Bio.Substring(0, 90) + "...";                  //   this line
            }
          }
          <p class="castText">@Html.DisplayFor(modelItem => item.Bio)</p>         @*this tag is the bio popup*@
        </a>
      </div>
      <div class="card-body">
        @Html.DisplayFor(modelItem => item.Name) |
        Role: @Html.DisplayFor(modelItem => item.MainRole)
        @{ if (item.YearJoined != null)
          {
            <p>Joined our cast: @Html.DisplayFor(modelItem => item.YearJoined)</p>;
          }
        }
        <p>
          @*Delete and edit are admin only*@

          @if (User.IsInRole("Admin"))
          {
            @Html.ActionLink("Edit", "Edit", new { id = item.CastMemberID })
            @(" |")
          }

          @if (User.IsInRole("Admin"))
          {
            @Html.ActionLink("Delete", "Delete", new { id = item.CastMemberID })
          }
        </p>
      </div>
    </div>
  }
  @*</div>*@
</div>